const assert = require('@barchart/common-js/lang/assert');

const DataOperationStage = require('./../../../DataOperationStage'),
	PortfolioDataOperation = require('./../../PortfolioDataOperation');

module.exports = (() => {
	'use strict';

	/**
	 * Saves a new position.
	 *
	 * @public
	 * @extends {PortfolioDataOperation}
	 */
	class Save extends PortfolioDataOperation {
		constructor(user, portfolio) {
			super();

			assert.argumentIsRequired(user, 'user', String);
			assert.argumentIsRequired(portfolio, 'portfolio', String);

			this._user = user;
			this._portfolio = portfolio;
		}

		get stage() {
			return DataOperationStage.SAVE;
		}

		_process(dataProvider) {
			return dataProvider.getPortfolio(this._user, this._portfolio)
				.then((portfolio) => {
					return dataProvider.savePortfolio(portfolio);
				});
		}

		_equals(other) {
			return other instanceof Save && other._user === this._user && other._portfolio === this._portfolio;
		}

		toString() {
			return '[Save]';
		}
	}

	return Save;
})();
