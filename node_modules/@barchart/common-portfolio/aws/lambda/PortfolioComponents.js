const is = require('@barchart/common-js/lang/is');

const DynamoProvider = require('@barchart/common-node-js/aws/DynamoProvider');

const PortfolioDataSessionFactory = require('./../../engine/portfolio/PortfolioDataSessionFactory');

module.exports = (() => {
	'use strict';

	/**
	 * A collection of static utility functions for use with the common
	 * library's Lambda tools.
	 *
	 * @public
	 */
	class PortfolioComponents {
		constructor() {

		}

		/**
		 * An initializer that generates a {@link PortfolioDataSessionFactory}
		 * (see {@link LambdaBuilder#usingComponentInitializer}).
		 *
		 * @public
		 * @returns {Function}
		 */
		static getSessionFactoryInitializer() {
			return (environment) => {
				return environment.getConfiguration()
					.then((configuration) => {
						if (!is.object(configuration) || !is.object(configuration.aws) || !is.object(configuration.aws.dynamo)) {
							throw new Error('Configuration data for Amazon DynamoDB is missing.');
						}

						const dynamo = new DynamoProvider(configuration.aws.dynamo);
						const sessionFactory = new PortfolioDataSessionFactory(dynamo);

						return sessionFactory.start().then(() => sessionFactory);
					});
			};
		}

		toString() {
			return '[PortfolioComponents]';
		}
	}

	return PortfolioComponents;
})();
